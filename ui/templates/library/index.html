{% extends "base.html" %}

{% block title %}×”×¡×¤×¨×™×™×” ×©×œ×™ - StudyBuddy{% endblock %}

{% block content %}
<div class="mb-6">
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
        <div>
            <h1 class="text-2xl md:text-3xl font-bold text-dark-brown">ğŸ“š ×”×¡×¤×¨×™×™×” ×©×œ×™</h1>
            <p class="text-cozy-brown mt-1">×›××Ÿ × ××¦××™× ×›×œ ×”×§×•×¨×¡×™× ×•×”×—×•××¨×™× ×©×œ×š</p>
        </div>
        <div class="flex gap-3">
            <a href="{{ url_for('library.profile') }}" 
               class="px-4 py-2 border-2 border-cozy-brown text-cozy-brown rounded-xl font-medium hover:bg-cozy-brown hover:text-cream transition-colors">
                ğŸ‘¤ ×”×¤×¨×•×¤×™×œ ×©×œ×™
            </a>
            {% if current_user.user.role.value == 'admin' or courses|length < max_courses %}
            <a href="{{ url_for('library.new_course') }}" 
               class="px-4 py-2 bg-golden-yellow text-dark-brown rounded-xl font-bold hover:bg-warm-yellow transition-colors shadow-md">
                â• ×§×•×¨×¡ ×—×“×©
            </a>
            {% endif %}
        </div>
    </div>
</div>

<!-- Quick Start Guide (shown if no courses) -->
{% if courses|length == 0 %}
<div class="bg-cream rounded-2xl p-8 shadow-md border-2 border-golden-yellow text-center mb-8">
    <div id="welcome-avner" class="mb-4"></div>
    <h2 class="text-xl font-bold text-dark-brown mb-3">×‘×¨×•×›×™× ×”×‘××™×! ğŸ¦«</h2>
    <p class="text-cozy-brown mb-6 max-w-lg mx-auto">
        ×–×” ×”××§×•× ×œ××¨×’×Ÿ ××ª ×›×œ ×—×•××¨×™ ×”×œ×™××•×“ ×©×œ×š.<br>
        ×¦×•×¨ ×§×•×¨×¡ ×—×“×© ×•×”×¢×œ×” ××œ×™×• ××ª ×”×—×•××¨×™× - ×•××‘× ×¨ ×™×¢×–×•×¨ ×œ×š ×œ×œ××•×“!
    </p>
    
    <div class="bg-warm-beige rounded-xl p-6 max-w-md mx-auto text-right mb-6">
        <h3 class="font-bold text-dark-brown mb-3">××™×š ×–×” ×¢×•×‘×“?</h3>
        <ol class="space-y-2 text-sm text-coffee">
            <li><span class="font-bold">1.</span> ×¦×•×¨ ×§×•×¨×¡ ×—×“×© (×œ××©×œ: "××‘×•× ×œ×¤×¡×™×›×•×œ×•×’×™×”")</li>
            <li><span class="font-bold">2.</span> ×”×¢×œ×” ×—×•××¨×™ ×œ×™××•×“ - ×¡×™×›×•××™×, ××¦×’×•×ª, PDF</li>
            <li><span class="font-bold">3.</span> ×”×©×ª××© ×‘×›×œ×™×: ×¡×™×›×•×, ×›×¨×˜×™×¡×™×•×ª, ×‘×—×™× ×•×ª</li>
            <li><span class="font-bold">4.</span> ×©××œ ××ª ××‘× ×¨ ×©××œ×•×ª ×¢×œ ×”×—×•××¨!</li>
        </ol>
    </div>
    
    <a href="{{ url_for('library.new_course') }}" 
       class="inline-flex items-center gap-2 px-6 py-3 bg-golden-yellow text-dark-brown rounded-xl font-bold hover:bg-warm-yellow transition-colors shadow-md text-lg">
        â• ×¦×•×¨ ××ª ×”×§×•×¨×¡ ×”×¨××©×•×Ÿ ×©×œ×š
    </a>
</div>
{% else %}

<!-- Courses Grid -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for course in courses %}
    <a href="{{ url_for('library.course_page', course_id=course.id) }}" 
       class="bg-cream rounded-2xl p-6 shadow-md border-2 hover:shadow-lg transition-all card-hover"
       style="border-color: {{ course.color }}">
        
        <div class="flex items-start justify-between mb-4">
            <div class="text-4xl">{{ course.icon }}</div>
            {% if course.has_content() %}
            <span class="px-2 py-1 bg-success text-white text-xs rounded-full">×¤×¢×™×œ</span>
            {% else %}
            <span class="px-2 py-1 bg-warning text-dark-brown text-xs rounded-full">×¨×™×§</span>
            {% endif %}
        </div>
        
        <h3 class="text-lg font-bold text-dark-brown mb-2 line-clamp-2">{{ course.name }}</h3>
        
        {% if course.description %}
        <p class="text-sm text-cozy-brown mb-3 line-clamp-2">{{ course.description }}</p>
        {% endif %}
        
        <div class="flex items-center gap-4 text-xs text-warm-gray">
            <span>ğŸ“„ {{ course.document_count }} ××¡××›×™×</span>
            <span>{{ '×¢×‘×¨×™×ª' if course.language.value == 'he' else 'English' }}</span>
        </div>
        
        {% if not course.has_content() %}
        <div class="mt-4 p-3 bg-warm-beige rounded-lg text-center">
            <p class="text-sm text-cozy-brown">ğŸ“¤ ×”×¢×œ×” ×—×•××¨×™× ×›×“×™ ×œ×”×ª×—×™×œ</p>
        </div>
        {% endif %}
    </a>
    {% endfor %}
    
    <!-- Add Course Card -->
    {% if current_user.user.role.value == 'admin' or courses|length < max_courses %}
    <a href="{{ url_for('library.new_course') }}" 
       class="bg-warm-beige rounded-2xl p-6 border-2 border-dashed border-warm-gray hover:border-golden-yellow transition-all flex flex-col items-center justify-center min-h-[200px] group">
        <div class="text-4xl mb-2 group-hover:scale-110 transition-transform">â•</div>
        <span class="text-cozy-brown font-medium group-hover:text-dark-brown">×”×•×¡×£ ×§×•×¨×¡ ×—×“×©</span>
        {% if current_user.user.role.value == 'admin' %}
        <span class="text-xs text-warm-gray mt-1">{{ courses|length }} ×§×•×¨×¡×™× (×× ×”×œ - ×œ×œ× ×”×’×‘×œ×”)</span>
        {% else %}
        <span class="text-xs text-warm-gray mt-1">{{ courses|length }}/{{ max_courses }}</span>
        {% endif %}
    </a>
    {% endif %}
</div>

{% endif %}

<!-- Usage Tips -->
<div class="mt-8 bg-warm-beige rounded-xl p-4 border border-warm-gray">
    <div class="flex items-center gap-3">
        <span class="text-2xl">ğŸ’¡</span>
        <p class="text-sm text-cozy-brown">
            <strong>×˜×™×¤:</strong> ×”×¢×œ×” ××ª ×›×œ ×”×—×•××¨×™× ×©×œ ×§×•×¨×¡ ×œ×ª×™×§×™×™×” ××—×ª. ×›×›×” ××‘× ×¨ ×™×•×›×œ ×œ×¢× ×•×ª ×¢×œ ×©××œ×•×ª ××›×œ ×”×—×•××¨!
        </p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Initialize welcome Avner
    document.addEventListener('DOMContentLoaded', function() {
        const welcomeContainer = document.getElementById('welcome-avner');
        if (welcomeContainer && typeof AvnerAvatar !== 'undefined') {
            new AvnerAvatar('welcome-avner', { size: 'large', showBubble: false });
        }
    });
</script>
{% endblock %}
