<!DOCTYPE html>
<html lang="{{ 'en' if current_locale == 'en' else 'he' }}" dir="{{ 'ltr' if current_locale == 'en' else 'rtl' }}" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}StudyBuddyAI{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <script src="https://unpkg.com/htmx.org@1.9.10" integrity="sha384-D1Kt99CQMDuVetoL1lrYwg5t+9QdHe7NLX/SoJYkXDFfX37iInKRy5xLSi8nO7UC" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
</head>
<body class="h-full flex flex-col bg-warm-beige font-sans text-dark-brown body-with-background">
    <!-- Navbar - Enhanced and Professional -->
    <nav class="bg-cozy-brown shadow-warm-lg sticky top-0 z-50">
        <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
            <div class="flex h-16 items-center justify-between">
                <!-- Right side: Logo and nav links (RTL) -->
                <div class="flex items-center gap-4">
                    <a href="{{ url_for('index') }}" class="flex-shrink-0 flex items-center gap-2 group">
                        <img src="{{ url_for('serve_avner', filename='avner_waving.jpeg') }}" alt="××‘× ×¨" class="h-12 w-12 rounded-full object-cover border-4 border-warm-yellow shadow-md group-hover:border-golden-yellow transition-all">
                        <div class="flex flex-col">
                            <span class="text-cream font-bold text-lg hidden sm:block">StudyBuddy</span>
                            <span class="text-warm-yellow text-xs hidden sm:block">××‘× ×¨ ×¢×•×–×¨ ×œ×š ×œ×œ××•×“ ğŸ¦«</span>
                        </div>
                    </a>
                    <div class="hidden md:block mr-4">
                        <div class="flex items-baseline gap-2">
                            <a href="{{ url_for('index') }}" class="nav-link {% if request.endpoint == 'index' %}nav-link-active{% endif %}">ğŸ  ×‘×™×ª</a>
                            {% if current_user.is_authenticated %}
                            <a href="{{ url_for('library.index') }}" class="nav-link {% if 'library' in request.endpoint %}nav-link-active{% endif %}">ğŸ“š ×”×¡×¤×¨×™×™×” ×©×œ×™</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Left side: User menu, Admin, Lang Switcher -->
                <div class="hidden md:flex items-center gap-3">
                    {% if current_user.is_authenticated %}
                        {% if current_user.user.role.value == 'admin' %}
                        <a href="{{ url_for('admin.dashboard') }}" class="text-cream hover:text-warm-yellow text-sm font-medium px-3 py-2 rounded-lg hover:bg-caramel transition-all">âš™ï¸ × ×™×”×•×œ</a>
                        {% endif %}
                        <a href="{{ url_for('library.profile') }}" class="inline-flex items-center gap-2 bg-gradient-to-r from-golden-yellow to-warm-yellow text-dark-brown text-sm px-4 py-2 rounded-full font-bold shadow-md hover:shadow-lg transition-all btn-hover-lift">
                            ğŸ‘¤ {{ current_user.user.name or current_user.user.email.split('@')[0] }}
                        </a>
                        <a href="{{ url_for('auth.logout') }}" class="text-cream hover:text-warm-yellow text-sm font-medium px-3 py-2 rounded-lg hover:bg-caramel transition-all">ğŸšª ×”×ª× ×ª×§</a>
                    {% else %}
                        <a href="{{ url_for('auth.login') }}" class="text-cream hover:text-warm-yellow text-sm font-medium px-3 py-2 rounded-lg hover:bg-caramel transition-all">ğŸ”‘ ×”×ª×—×‘×¨</a>
                        <a href="{{ url_for('auth.signup') }}" class="bg-gradient-to-r from-golden-yellow to-warm-yellow text-dark-brown text-sm px-5 py-2 rounded-full font-bold shadow-md hover:shadow-lg transition-all btn-hover-lift">âœ¨ ×”×¨×©××”</a>
                    {% endif %}
                    <!-- Language Switcher -->
                    <div class="text-sm">
                        {% if current_locale == 'he' %}
                            <a href="{{ url_for('set_lang', lang='en') }}" class="text-cream hover:text-warm-yellow font-medium px-2 py-1 rounded transition-all">EN</a>
                        {% else %}
                            <a href="{{ url_for('set_lang', lang='he') }}" class="text-cream hover:text-warm-yellow font-medium px-2 py-1 rounded transition-all">×¢×‘</a>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Mobile hamburger button -->
                <div class="md:hidden flex items-center gap-2">
                    <!-- Language Switcher for Mobile -->
                    <div class="text-sm">
                        {% if current_locale == 'he' %}
                            <a href="{{ url_for('set_lang', lang='en') }}" class="text-cream hover:text-warm-yellow">EN</a>
                        {% else %}
                            <a href="{{ url_for('set_lang', lang='he') }}" class="text-cream hover:text-warm-yellow">×¢×‘</a>
                        {% endif %}
                    </div>
                    <button type="button" id="mobile-menu-button" class="inline-flex items-center justify-center rounded-lg p-2 text-cream hover:bg-caramel">
                        <svg id="menu-icon-open" class="block h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" /></svg>
                        <svg id="menu-icon-close" class="hidden h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile menu -->
        <div class="md:hidden hidden" id="mobile-menu">
            <div class="space-y-1 px-4 pb-4 pt-2 bg-cozy-brown rounded-b-2xl border-t-2 border-caramel">
                <a href="{{ url_for('index') }}" class="block rounded-lg px-3 py-3 text-base text-cream hover:bg-caramel transition-all font-medium">ğŸ  ×‘×™×ª</a>
                {% if current_user.is_authenticated %}
                <a href="{{ url_for('library.index') }}" class="block rounded-lg px-3 py-3 text-base text-cream hover:bg-caramel transition-all font-medium">ğŸ“š ×”×¡×¤×¨×™×™×” ×©×œ×™</a>
                <div class="pt-3 border-t-2 border-caramel mt-2">
                    <a href="{{ url_for('library.profile') }}" class="block rounded-lg px-3 py-3 text-base text-warm-yellow font-bold hover:bg-caramel transition-all">ğŸ‘¤ ×¤×¨×•×¤×™×œ</a>
                    {% if current_user.user.role.value == 'admin' %}
                    <a href="{{ url_for('admin.dashboard') }}" class="block rounded-lg px-3 py-3 text-base text-cream hover:bg-caramel transition-all font-medium">âš™ï¸ × ×™×”×•×œ</a>
                    {% endif %}
                    <a href="{{ url_for('auth.logout') }}" class="block rounded-lg px-3 py-3 text-base text-cream hover:bg-caramel transition-all font-medium">ğŸšª ×”×ª× ×ª×§</a>
                </div>
                {% else %}
                <div class="pt-3 border-t-2 border-caramel mt-2">
                    <a href="{{ url_for('auth.login') }}" class="block rounded-lg px-3 py-3 text-base text-cream hover:bg-caramel transition-all font-medium">ğŸ”‘ ×”×ª×—×‘×¨</a>
                    <a href="{{ url_for('auth.signup') }}" class="block rounded-lg px-3 py-3 text-base text-warm-yellow font-bold hover:bg-caramel transition-all">âœ¨ ×”×¨×©××”</a>
                </div>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- Main content -->
    <main class="flex-grow">
        <div class="mx-auto max-w-6xl px-4 py-8 sm:px-6 lg:px-8">
            {% block content %}{% endblock %}
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-cozy-brown py-6 mt-8">
        <div class="max-w-6xl mx-auto px-4">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                <div class="flex items-center gap-3">
                    <img src="{{ url_for('serve_avner', filename='avner_signing_ok.jpeg') }}" alt="××‘× ×¨" class="h-10 w-10 rounded-full border-2 border-warm-yellow">
                    <div class="text-cream text-sm">
                        <p class="font-bold">StudyBuddyAI - ××‘× ×¨ ×¢×•×–×¨ ×œ×š ×œ×œ××•×“</p>
                        <p class="text-xs text-warm-gray">×œ××™×“×” ×—×›××” ×¢× ×‘×™× ×” ××œ××›×•×ª×™×ª ğŸ¦«</p>
                    </div>
                </div>
                <p class="text-center text-cream text-sm">Â© 2024 StudyBuddyAI - ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª</p>
            </div>
        </div>
    </footer>
    
    <script>
        // Mobile menu toggle script (Restored)
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const menuIconOpen = document.getElementById('menu-icon-open');
        const menuIconClose = document.getElementById('menu-icon-close');
        
        if (mobileMenuButton && mobileMenu) {
            mobileMenuButton.addEventListener('click', function() {
                mobileMenu.classList.toggle('hidden');
                menuIconOpen.classList.toggle('hidden');
                menuIconClose.classList.toggle('hidden');
            });
        }
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>
