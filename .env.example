# =============================================================================
# StudyBuddy Configuration File
# =============================================================================
# Copy this file to .env and fill in your values:
#   cp .env.example .env
#   nano .env  # or vim, code, etc.
#
# After editing, restart the application:
#   docker compose restart app
#   # OR
#   sudo systemctl restart studybuddy
#
# For troubleshooting, see TROUBLESHOOTING.md
# =============================================================================

# -----------------------------------------------------------------------------
# CORE CONFIGURATION
# -----------------------------------------------------------------------------

# Flask Configuration
FLASK_ENV="development" # "development" or "production"

# Secret Key (REQUIRED - Generate a secure random key)
# Generate with: python -c 'import secrets; print(secrets.token_hex(32))'
# The deploy script auto-generates this if not set
SECRET_KEY="change-this-to-a-very-secret-key-in-production"

# Domain Configuration (IMPORTANT!)
# Set these to your actual domain for production
# For local development, use localhost
DOMAIN="studybuddyai.my"
BASE_URL="https://studybuddyai.my"  # MUST match where users access the site!
                                     # Examples:
                                     # - Production: https://yourdomain.com
                                     # - Development: http://localhost:5000
                                     # - Local network: http://192.168.1.xxx:5000

# -----------------------------------------------------------------------------
# INFRASTRUCTURE (Docker defaults usually work fine)
# -----------------------------------------------------------------------------

# MongoDB URI (Docker Compose default works)
# For Docker: mongodb://mongo:27017/studybuddy
# For local: mongodb://localhost:27017/studybuddy
MONGO_URI="mongodb://mongo:27017/studybuddy"

# RabbitMQ URI (Docker Compose default works)
RABBITMQ_URI="amqp://user:password@rabbitmq:5672/"

# -----------------------------------------------------------------------------
# HEALTH MONITORING (OPTIONAL)
# -----------------------------------------------------------------------------
# Configure these to receive email alerts when the app becomes unhealthy
# Run: sudo ./scripts/setup_health_monitor.sh to install the monitor

# Health check URL (default: http://localhost:5000/health)
HEALTH_CHECK_URL="http://localhost:5000/health"

# How often to check health in seconds (default: 60)
HEALTH_CHECK_INTERVAL="60"

# Number of consecutive failures before sending alert (default: 3)
MAX_CONSECUTIVE_FAILURES="3"

# Seconds between alert emails to avoid spam (default: 3600 = 1 hour)
ALERT_COOLDOWN_SECONDS="3600"

# -----------------------------------------------------------------------------
# AI SERVICES (AT LEAST ONE REQUIRED!)
# -----------------------------------------------------------------------------
# You MUST configure at least one AI provider for the app to work.
# Recommended: Start with Gemini (has free tier)

# OpenAI API Key
# Get from: https://platform.openai.com/api-keys
# Note: Requires payment/credits
OPENAI_API_KEY="your_openai_api_key_here"

# Google Gemini API Key (RECOMMENDED - Free tier available!)
# Get from: https://makersuite.google.com/app/apikey
# Free tier: 60 requests per minute
GEMINI_API_KEY="your_google_gemini_api_key_here"

# AI Model Configuration (SB_* prefix for StudyBuddy)
# Triple Hybrid AI System:
# - Heavy files (audio/long PDF): Gemini 1.5 Flash (native multimodal)
# - Quiz generation: GPT-4o-mini with JSON enforcement
# - Standard tasks: GPT-4o-mini
# - Complex reasoning: GPT-4o
# - Baby Capy mode: GPT-4o-mini with simplified prompts
#
# IMPORTANT: Use the FULL model name including "-latest" suffix!
# ❌ WRONG: gemini-1.5-flash (will cause 404 errors)
# ✅ CORRECT: gemini-1.5-flash-latest
SB_OPENAI_MODEL="gpt-4o-mini"        # OpenAI model to use (standard tasks)
SB_GEMINI_MODEL="gemini-1.5-flash-latest"   # Gemini model to use (heavy files, glossary)
SB_DEFAULT_PROVIDER="gemini"          # Default AI provider: "gemini" or "openai"
SB_BASE_URL=""                        # Optional custom base URL for API

# -----------------------------------------------------------------------------
# UNSPLASH API (Optional - for Capybara of the Day feature)
# -----------------------------------------------------------------------------
# Get a FREE access key from: https://unsplash.com/developers
# Used to fetch funny capybara photos for the "Meet the Family" section
# If not configured, will use local Avner images as fallback
UNSPLASH_ACCESS_KEY=""

# -----------------------------------------------------------------------------
# LOGGING
# -----------------------------------------------------------------------------

# Logging Level
# Use "DEBUG" for development to see all logs
# Use "INFO" for production
LOG_LEVEL="DEBUG"

# -----------------------------------------------------------------------------
# ADMIN CONFIGURATION
# -----------------------------------------------------------------------------

# Admin Email (Optional but recommended)
# Set this to your email to get admin access automatically
ADMIN_EMAIL="your_admin_email@example.com"

# Initial Admin Password (Optional)
# Only used on first startup if admin doesn't exist
# Leave empty to manually set password later
ADMIN_PASSWORD=""

# -----------------------------------------------------------------------------
# EMAIL CONFIGURATION (Optional but recommended for verification)
# -----------------------------------------------------------------------------
# Required for:
# - Email verification on signup
# - Password reset emails
# - Admin notifications
#
# Gmail Setup:
# 1. Enable 2-Step Verification in your Google Account
# 2. Generate App Password: https://myaccount.google.com/apppasswords
# 3. Use the 16-character app password below

MAIL_SERVER="smtp.gmail.com"
MAIL_PORT=587
MAIL_USE_TLS=true

# Your Gmail address
MAIL_USERNAME="your_email@gmail.com"

# Your Gmail App Password (16 characters, no spaces)
# NOT your regular Gmail password!
MAIL_PASSWORD="your_app_password_here"

# Sender name that appears in emails
MAIL_DEFAULT_SENDER="StudyBuddy <your_email@gmail.com>"

# -----------------------------------------------------------------------------
# OAUTH CONFIGURATION (Optional - for Google/Apple Sign-In)
# -----------------------------------------------------------------------------

# Google Sign-In (Optional but recommended)
# Get credentials from: https://console.cloud.google.com/
# 1. Create new project or select existing
# 2. Enable Google+ API
# 3. Go to "Credentials" > "Create Credentials" > "OAuth client ID"
# 4. Application type: Web application
# 5. Add Authorized redirect URI:
#    IMPORTANT: Must match your BASE_URL exactly!
#    - For production: https://yourdomain.com/oauth/google/callback
#    - For development: http://localhost:5000/oauth/google/callback
#    - If using custom port: http://localhost:PORT/oauth/google/callback
#    - If accessing via IP: http://192.168.x.x:PORT/oauth/google/callback
# 6. Copy Client ID and Client Secret below
#
# TROUBLESHOOTING redirect_uri_mismatch error:
# - Verify BASE_URL above matches exactly how users access your site
# - Check Google Console has the EXACT redirect URI with /oauth/google/callback
# - If changed BASE_URL, restart the app: docker compose restart or systemctl restart studybuddy

GOOGLE_CLIENT_ID=""
GOOGLE_CLIENT_SECRET=""

# Apple Sign-In (Optional - Advanced)
# Get credentials from: https://developer.apple.com/
# Requires Apple Developer account
APPLE_CLIENT_ID=""      # Service ID
APPLE_TEAM_ID=""
APPLE_KEY_ID=""
APPLE_PRIVATE_KEY=""    # Contents of .p8 file

# -----------------------------------------------------------------------------
# SECURITY SETTINGS
# -----------------------------------------------------------------------------

# Session Cookie Security (Set secure=true for HTTPS in production)
SESSION_COOKIE_SECURE=false    # Set to true when using HTTPS
SESSION_COOKIE_HTTPONLY=true
SESSION_COOKIE_SAMESITE="Lax"

# -----------------------------------------------------------------------------
# WEBHOOK CONFIGURATION (Optional - for auto-updates via GitHub)
# -----------------------------------------------------------------------------

# GitHub Webhook Secret (Optional)
# Generate with: openssl rand -hex 32
# Then configure webhook in GitHub:
# - Go to: Settings > Webhooks > Add webhook
# - Payload URL: https://yourdomain.com/webhook/update
# - Content type: application/json
# - Secret: (paste generated secret)
# - Events: Just the push event
WEBHOOK_SECRET=""

# =============================================================================
# QUICK START GUIDE
# =============================================================================
#
# Minimum required for basic operation:
#
# 1. AI Provider (at least one):
#    GEMINI_API_KEY="your_key"  # Recommended - has free tier
#    # OR
#    OPENAI_API_KEY="your_key"
#
# 2. Domain (if not localhost):
#    DOMAIN="yourdomain.com"
#    BASE_URL="https://yourdomain.com"
#
# Optional but recommended:
#
# 3. Email (for verification):
#    MAIL_USERNAME="your_email@gmail.com"
#    MAIL_PASSWORD="your_app_password"
#
# 4. Google Sign-In:
#    GOOGLE_CLIENT_ID="your_id"
#    GOOGLE_CLIENT_SECRET="your_secret"
#
# =============================================================================
# VALIDATION AND TROUBLESHOOTING
# =============================================================================
#
# Check your configuration:
#   python check_config.py
#
# The app will validate configuration on startup.
# If critical config is missing, it will show clear error messages.
#
# For detailed help, see TROUBLESHOOTING.md
#
# =============================================================================
